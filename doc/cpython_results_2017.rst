+++++++++++++++++++++
CPython results, 2017
+++++++++++++++++++++

This page lists benchmarks which became faster in CPython.

Optimizations
=============

2016-12-14: speedup method calls
--------------------------------

Optimization: `Speedup method calls 1.2x
<https://bugs.python.org/issue26110>`_, `commit f2392133
<https://github.com/python/cpython/commit/f2392133eba777f05947a8996c507690b95379c3>`_.

+---------------------+---------------------------+------------------------------+
| Benchmark           | 2016-12-01 (27580c1fb5e8) | 2017-01-01 (67e1aa0b58be)    |
+=====================+===========================+==============================+
| call_method         | 14.1 ms                   | 11.2 ms: 1.26x faster (-21%) |
+---------------------+---------------------------+------------------------------+
| call_method_slots   | 13.9 ms                   | 11.1 ms: 1.25x faster (-20%) |
+---------------------+---------------------------+------------------------------+
| call_method_unknown | 16.0 ms                   | 14.3 ms: 1.12x faster (-11%) |
+---------------------+---------------------------+------------------------------+

2016-04-22: pymalloc allocator, unpickle_list
---------------------------------------------

Optimization: `PyMem_Malloc() now uses the fast pymalloc allocator
<http://bugs.python.org/issue26249>`_, `commit f5c4b990
<https://github.com/python/cpython/commit/f5c4b99034fae12ac2b9498dd12b5b3f352b90c8>`_.

+----------------+---------------------------+-------------------------------+
| Benchmark      | 2016-04-01 (dcfebb32e277) | 2016-05-01 (f1e2671fdf88)     |
+================+===========================+===============================+
| unpickle_list  | 10.4 us                   | 7.87 us: 1.32x faster (-24%)  |
+----------------+---------------------------+-------------------------------+

2015-12-07: Optimize ElementTree.iterparse(), xml_etree_iterparse
-----------------------------------------------------------------

Optimization: `Issue #25638: Optimized ElementTree.iterparse(); it is now 2x
faster <http://bugs.python.org/issue25638>`_, `commit 9ec5e25f2
<https://github.com/python/cpython/commit/9ec5e25f26a490510bb5da5c26a276cd30a263a0>`_.

+---------------------+---------------------------+-----------------------------+
| Benchmark           | 2015-10-01 (30b7138fe12b) | 2016-01-01 (899b72cee21c)   |
+=====================+===========================+=============================+
| xml_etree_iterparse | 438 ms                    | 209 ms: 2.10x faster (-52%) |
+---------------------+---------------------------+-----------------------------+

2015-09-19: PGO uses test suite, pidigits
-----------------------------------------

Optimization: `Issue #24915: Add Clang support to PGO builds and use the test
suite for profile data <http://bugs.python.org/issue24915>`_, `commit 7188a3ef
<https://github.com/python/cpython/commit/7188a3efe07b9effdb760f3a96783f250214f0be>`_.

+-----------+---------------------------+-----------------------------+
| Benchmark | 2015-09-01 (799b05b0527d) | 2015-10-01 (0d30940dd256)   |
+===========+===========================+=============================+
| pidigits  | 332 ms                    | 285 ms: 1.16x faster (-14%) |
+-----------+---------------------------+-----------------------------+

2015-05-30: C implementation of collections.OrderedDict, html5lib
-----------------------------------------------------------------

Optimization: `Issue #16991: Add a C implementation of collections.OrderedDict
<http://bugs.python.org/issue16991>`_, `commit 96c6af9b
<https://github.com/python/cpython/commit/96c6af9b207c188c52ac53ce87bb7f2dea3f328b>`_.

+-----------+---------------------------+-----------------------------+
| Benchmark | 2015-04-01 (4fd929b43121) | 2015-07-01 (d7982beca93c)   |
+===========+===========================+=============================+
| html5lib  | 293 ms                    | 246 ms: 1.19x faster (-16%) |
+-----------+---------------------------+-----------------------------+

2015-05-23: C implementation of functools.lru_cache(), sympy
------------------------------------------------------------

Optimization: `Issue #14373: Added C implementation of functools.lru_cache()
<http://bugs.python.org/issue14373>`_, `commit 1c858c35
<https://github.com/python/cpython/commit/1c858c352b8c11419f79f586334c49378726dba8>`_.

This change optimized sympy_expand at least.

+-----------------+---------------------------+-------------------------------+
| Benchmark       | 2015-04-01 (4fd929b43121) | 2015-07-01 (d7982beca93c)     |
+=================+===========================+===============================+
| sympy_expand    | 1.48 sec                  | 1.17 sec: 1.27x faster (-21%) |
+-----------------+---------------------------+-------------------------------+
| sympy_integrate | 54.4 ms                   | 46.8 ms: 1.16x faster (-14%)  |
+-----------------+---------------------------+-------------------------------+
| sympy_sum       | 307 ms                    | 254 ms: 1.21x faster (-17%)   |
+-----------------+---------------------------+-------------------------------+
| sympy_str       | 630 ms                    | 510 ms: 1.24x faster (-19%)   |
+-----------------+---------------------------+-------------------------------+


Slowdown
========

2016-09-11: regex_compile
-------------------------

Slowdown: `convert re flags to (much friendlier) IntFlag constants (issue
#28082) <http://bugs.python.org/issue28082>`_, `commit
f93395bc
<https://github.com/python/cpython/commit/f93395bc5125c99539597bf134ca8bcf9707655b>`_.

+---------------+---------------------------+----------------------------+-----------------------------+
| Benchmark     | 2016-04-01 (6b6abd4cf10e) | 2016-07-01 (355048970b2a)  | 2016-10-01 (78a111c7d867)   |
+===============+===========================+============================+=============================+
| regex_compile | 339 ms                    | 309 ms: 1.10x faster (-9%) | 383 ms: 1.13x slower (+13%) |
+---------------+---------------------------+----------------------------+-----------------------------+


Timeline
========

April, 2016 -> May, 2016
------------------------

2016-04-01 .. 2016-05-01:

+----------------+---------------------------+-------------------------------+
| Benchmark      | 2016-04-01 (dcfebb32e277) | 2016-05-01 (f1e2671fdf88)     |
+================+===========================+===============================+
| nqueens        | 255 ms                    | 207 ms: 1.23x faster (-19%)   |
+----------------+---------------------------+-------------------------------+
| raytrace       | 1.31 sec                  | 1.09 sec: 1.19x faster (-16%) |
+----------------+---------------------------+-------------------------------+
| float          | 290 ms                    | 243 ms: 1.19x faster (-16%)   |
+----------------+---------------------------+-------------------------------+
| chaos          | 273 ms                    | 235 ms: 1.16x faster (-14%)   |
+----------------+---------------------------+-------------------------------+
| hexiom         | 21.0 ms                   | 18.6 ms: 1.13x faster (-11%)  |
+----------------+---------------------------+-------------------------------+
| deltablue      | 16.4 ms                   | 14.6 ms: 1.12x faster (-11%)  |
+----------------+---------------------------+-------------------------------+
| go             | 557 ms                    | 502 ms: 1.11x faster (-10%)   |
+----------------+---------------------------+-------------------------------+
| meteor_contest | 204 ms                    | 185 ms: 1.10x faster (-9%)    |
+----------------+---------------------------+-------------------------------+
| nbody          | 254 ms                    | 232 ms: 1.10x faster (-9%)    |
+----------------+---------------------------+-------------------------------+

call_method
-----------

Timeline 2016-04-01 .. 2017-01-01:

+---------------------+---------------------------+------------------------------+------------------------------+--------------------------------------+
| Benchmark           | 2016-04-01 (6b6abd4cf10e) | 2016-07-01 (355048970b2a)    | 2016-10-01 (78a111c7d867)    | 2017-01-01 (67e1aa0b58be)            |
+=====================+===========================+==============================+==============================+======================================+
| call_method         | 15.8 ms                   | 14.9 ms: 1.06x faster (-6%)  | 14.1 ms: 1.13x faster (-11%) | 11.2 ms: 1.42x faster (-29%)         |
+---------------------+---------------------------+------------------------------+------------------------------+--------------------------------------+
| call_method_slots   | 15.7 ms                   | 15.2 ms: 1.03x faster (-3%)  | 14.0 ms: 1.13x faster (-11%) | 11.1 ms: 1.42x faster (-29%)         |
+---------------------+---------------------------+------------------------------+------------------------------+--------------------------------------+
| call_method_unknown | 17.7 ms                   | 15.9 ms: 1.11x faster (-10%) | 15.6 ms: 1.13x faster (-11%) | 14.3 ms: 1.23x faster (-19%)         |
+---------------------+---------------------------+------------------------------+------------------------------+--------------------------------------+

crypto_pyaes
------------

.. XXX failed to any significant diff on smithers
   between dcfebb32e277a68b9c6582e6a0484e6d (2016-04-01) and f1e2671fdf88fce8a367ee63aba4a (2016-05-01)
   (diff: -1%)

+--------------+---------------------------+-----------------------------+
| Benchmark    | 2016-01-01 (899b72cee21c) | 2016-10-01 (78a111c7d867)   |
+==============+===========================+=============================+
| crypto_pyaes | 240 ms                    | 199 ms: 1.20x faster (-17%) |
+--------------+---------------------------+-----------------------------+

json_loads
----------

Progress on 21 months, 2015-01-01 .. 2016-10-01:

+------------+---------------------------+------------------------------+
| Benchmark  | 2015-01-01 (52074ac866eb) | 2016-10-01 (78a111c7d867)    |
+============+===========================+==============================+
| json_loads | 64.0 us                   | 56.6 us: 1.13x faster (-11%) |
+------------+---------------------------+------------------------------+


logging_silent
--------------

+----------------+---------------------------+-----------------------------+
| Benchmark      | 2016-01-01 (899b72cee21c) | 2016-07-01 (355048970b2a)   |
+================+===========================+=============================+
| logging_silent | 718 ns                    | 606 ns: 1.18x faster (-16%) |
+----------------+---------------------------+-----------------------------+

pickle
------

pickle, 2015-07-01 .. 2015-10-01:

.. XXX 2015-09 => 2015-10, unable to reproduce on smithers
   XXX unable to reproduce on speed-python (no LTO, no PGO)
   XXX
   XXX commit 7188a3efe07b9effdb760f3a96783f250214f0be related to PGO?

+-----------+---------------------------+------------------------------+
| Benchmark | 2015-09-01 (799b05b0527d) | 2015-10-01 (0d30940dd256)    |
+===========+===========================+==============================+
| pickle    | 32.1 us                   | 26.7 us: 1.20x faster (-17%) |
+-----------+---------------------------+------------------------------+

pickle, 2016-08-02 .. 2016-09-08:

.. XXX unable to reproduce on speed-python (no LTO, no PGO)
   133138a284be1985ebd9ec9014f1306b9a425 .. 10427f44852b6e872034061421a8890902b8f
   diff: -6%

.. commit 711120d8fd0445b33655101d72b0f576646bff9f faster import?
   http://bugs.python.org/issue22557

+-----------+---------------------------+------------------------------+
| Benchmark | 2016-08-02 (133138a284be) | 2016-09-08 (10427f44852b)    |
+===========+===========================+==============================+
| pickle    | 25.5 us                   | 21.4 us: 1.19x faster (-16%) |
+-----------+---------------------------+------------------------------+

pickle dict/list:

+-------------+---------------------------+------------------------------+
| Benchmark   | 2016-04-01 (6b6abd4cf10e) | 2016-10-01 (78a111c7d867)    |
+=============+===========================+==============================+
| pickle_dict | 64.5 us                   | 57.7 us: 1.12x faster (-11%) |
+-------------+---------------------------+------------------------------+
| pickle_list | 9.06 us                   | 7.79 us: 1.16x faster (-14%) |
+-------------+---------------------------+------------------------------+

unpickle:

+-----------+---------------------------+------------------------------+
| Benchmark | 2015-07-01 (d7982beca93c) | 2015-10-01 (30b7138fe12b)    |
+===========+===========================+==============================+
| unpickle  | 36.9 us                   | 32.8 us: 1.13x faster (-11%) |
+-----------+---------------------------+------------------------------+



python_startup
--------------

2015-04-01 .. 2015-10-01:

+------------------------+---------------------------+-----------------------------+
| Benchmark              | 2015-04-01 (4fd929b43121) | 2015-10-01 (30b7138fe12b)   |
+========================+===========================+=============================+
| python_startup         | 16.4 ms                   | 17.2 ms: 1.05x slower (+5%) |
+------------------------+---------------------------+-----------------------------+
| python_startup_no_site | 8.65 ms                   | 8.90 ms: 1.03x slower (+3%) |
+------------------------+---------------------------+-----------------------------+

2016-04-01 .. 2017-01-01:

+------------------------+---------------------------+------------------------------+
| Benchmark              | 2016-04-01 (6b6abd4cf10e) | 2017-01-01 (67e1aa0b58be)    |
+========================+===========================+==============================+
| python_startup         | 17.3 ms                   | 14.5 ms: 1.20x faster (-16%) |
+------------------------+---------------------------+------------------------------+
| python_startup_no_site | 8.89 ms                   | 8.39 ms: 1.06x faster (-6%)  |
+------------------------+---------------------------+------------------------------+


regex_compile
-------------

+---------------+---------------------------+----------------------------+-----------------------------+
| Benchmark     | 2016-04-01 (6b6abd4cf10e) | 2016-07-01 (355048970b2a)  | 2016-10-01 (78a111c7d867)   |
+===============+===========================+============================+=============================+
| regex_compile | 339 ms                    | 309 ms: 1.10x faster (-9%) | 383 ms: 1.13x slower (+13%) |
+---------------+---------------------------+----------------------------+-----------------------------+

telco
-----

+-----------+---------------------------+-----------------------------+-----------------------------+------------------------------+------------------------------+
| Benchmark | 2016-01-01 (899b72cee21c) | 2016-04-01 (6b6abd4cf10e)   | 2016-07-01 (355048970b2a)   | 2016-10-01 (78a111c7d867)    | 2017-03-31 (cdcac039fb44)    |
+===========+===========================+=============================+=============================+==============================+==============================+
| telco     | 19.6 ms                   | 19.2 ms: 1.02x faster (-2%) | 18.3 ms: 1.08x faster (-7%) | 15.1 ms: 1.30x faster (-23%) | 13.9 ms: 1.41x faster (-29%) |
+-----------+---------------------------+-----------------------------+-----------------------------+------------------------------+------------------------------+

scimark
-------

.. XXX unable to reproduce on smithers (without LTO nor PGO), ef158c3ced3f (2017-02-01) .. 1cf2a809b1eb4f9fc8ac3ccc97424586892d1e1a (2017-02-28)

2016-10-01 .. 2017-03-31:

+-------------+---------------------------+-----------------------------+-----------------------------+
| Benchmark   | 2016-10-01 (78a111c7d867) | 2017-01-01 (67e1aa0b58be)   | 2017-03-31 (cdcac039fb44)   |
+=============+===========================+=============================+=============================+
| scimark_lu  | 423 ms                    | 378 ms: 1.12x faster (-11%) | 318 ms: 1.33x faster (-25%) |
+-------------+---------------------------+-----------------------------+-----------------------------+
| scimark_sor | 426 ms                    | 403 ms: 1.06x faster (-5%)  | 375 ms: 1.14x faster (-12%) |
+-------------+---------------------------+-----------------------------+-----------------------------+

sqlalchemy_declarative
----------------------

+------------------------+---------------------------+-----------------------------+
| Benchmark              | 2014-10-01 (5a789f7eaf81) | 2015-10-01 (30b7138fe12b)   |
+========================+===========================+=============================+
| sqlalchemy_declarative | 345 ms                    | 301 ms: 1.15x faster (-13%) |
+------------------------+---------------------------+-----------------------------+

sympy
-----

2016-04-01 .. 2016-10-01:

+-----------------+---------------------------+------------------------------+------------------------------+
| Benchmark       | 2016-04-01 (6b6abd4cf10e) | 2016-07-01 (355048970b2a)    | 2016-10-01 (78a111c7d867)    |
+=================+===========================+==============================+==============================+
| sympy_expand    | 1.10 sec                  | 1.01 sec: 1.09x faster (-8%) | 942 ms: 1.17x faster (-14%)  |
+-----------------+---------------------------+------------------------------+------------------------------+
| sympy_integrate | 46.6 ms                   | 42.9 ms: 1.09x faster (-8%)  | 41.2 ms: 1.13x faster (-11%) |
+-----------------+---------------------------+------------------------------+------------------------------+
| sympy_sum       | 247 ms                    | 233 ms: 1.06x faster (-6%)   | 199 ms: 1.24x faster (-19%)  |
+-----------------+---------------------------+------------------------------+------------------------------+
| sympy_str       | 483 ms                    | 454 ms: 1.07x faster (-6%)   | 427 ms: 1.13x faster (-12%)  |
+-----------------+---------------------------+------------------------------+------------------------------+

xml_etree_generate
------------------

+--------------------+---------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+
| Benchmark          | 2015-04-01 (4fd929b43121) | 2015-07-01 (d7982beca93c)  | 2015-10-01 (30b7138fe12b)  | 2016-01-01 (899b72cee21c)   | 2016-07-01 (355048970b2a)   |
+====================+===========================+============================+============================+=============================+=============================+
| xml_etree_generate | 282 ms                    | 267 ms: 1.06x faster (-5%) | 256 ms: 1.10x faster (-9%) | 237 ms: 1.19x faster (-16%) | 212 ms: 1.33x faster (-25%) |
+--------------------+---------------------------+----------------------------+----------------------------+-----------------------------+-----------------------------+
